<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Exocortex Timeline</title>
    <style>
        body { font-family: Arial, sans-serif; background: #0c0c0f; color: #f2f2f2; margin: 0; padding: 1.5rem; }
        h1 { margin-top: 0; }
        .event { background: #16161d; border: 1px solid #222233; border-radius: 8px; padding: 1rem; margin-bottom: 1rem; }
        .meta { color: #9aa0b3; font-size: 0.9rem; margin-bottom: 0.5rem; }
        .tags span { background: #2a2a3a; color: #cbd5ff; padding: 0.2rem 0.6rem; border-radius: 999px; margin-right: 0.3rem; font-size: 0.85rem; }
    </style>
</head>
<body>
    <h1>Recent Events</h1>

    <form method="get" style="margin-bottom: 1.5rem; display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 0.8rem; background: #11111a; padding: 1rem; border-radius: 8px; border: 1px solid #222233;">
        <div>
            <label for="start">Start</label><br />
            <input type="datetime-local" id="start" name="start" value="{{ filters.get('start') or '' }}" style="width: 100%; padding: 0.4rem; background: #0c0c0f; color: #f2f2f2; border: 1px solid #222233; border-radius: 6px;" />
        </div>
        <div>
            <label for="end">End</label><br />
            <input type="datetime-local" id="end" name="end" value="{{ filters.get('end') or '' }}" style="width: 100%; padding: 0.4rem; background: #0c0c0f; color: #f2f2f2; border: 1px solid #222233; border-radius: 6px;" />
        </div>
        <div>
            <label for="source_system">Source</label><br />
            <input type="text" id="source_system" name="source_system" placeholder="gmail_school" value="{{ filters.get('source_system') or '' }}" style="width: 100%; padding: 0.4rem; background: #0c0c0f; color: #f2f2f2; border: 1px solid #222233; border-radius: 6px;" />
        </div>
        <div>
            <label for="channel">Channel</label><br />
            <input type="text" id="channel" name="channel" placeholder="email" value="{{ filters.get('channel') or '' }}" style="width: 100%; padding: 0.4rem; background: #0c0c0f; color: #f2f2f2; border: 1px solid #222233; border-radius: 6px;" />
        </div>
        <div>
            <label for="tag">Tag</label><br />
            <input type="text" id="tag" name="tag" placeholder="school" value="{{ filters.get('tag') or '' }}" style="width: 100%; padding: 0.4rem; background: #0c0c0f; color: #f2f2f2; border: 1px solid #222233; border-radius: 6px;" />
        </div>
        <div style="display: flex; align-items: flex-end; gap: 0.6rem;">
            <button type="submit" style="padding: 0.6rem 1rem; background: #2f80ed; border: none; color: white; border-radius: 6px; cursor: pointer;">Apply Filters</button>
            <a href="/" style="padding: 0.6rem 1rem; background: #2a2a3a; color: #f2f2f2; text-decoration: none; border-radius: 6px;">Reset</a>
        </div>
    </form>
    {% if events %}
        {% for event in events %}
            <div class="event">
                <div class="meta">
                    <strong>{{ event['summary'] or 'No summary' }}</strong><br>
                    {{ event['timestamp'] }} &middot; {{ event['source_system'] }} / {{ event['channel'] }}
                    {% if event['actor'] %} &middot; Actor: {{ event['actor'] }}{% endif %}
                    {% if event['direction'] %} &middot; {{ event['direction'] }}{% endif %}
                </div>
                {% if event['content_text'] %}<p>{{ event['content_text'] }}</p>{% endif %}
                {% if event['tags'] %}
                    <div class="tags">
                        {% for tag in event['tags'] %}
                            <span>{{ tag }}</span>
                        {% endfor %}
                    </div>
                {% endif %}
            </div>
        {% endfor %}
    {% else %}
        <p>No events logged yet. POST an event to <code>/events</code> to get started.</p>
    {% endif %}
</body>
</html>
